!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i={realTimePvp:"REAL_TIME_PVP",asyncPvp:"ASYNC_PVP",singlePlayer:"SINGLE_PLAYER"},r="SINGLE_PLAYER",a="Error: game not started yet!",s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"version","1.0.1"),o(this,"versionCode",0),o(this,"matchType",i.singlePlayer),o(this,"gameType",r),o(this,"currentUser",{}),o(this,"otherPlayers",[]),o(this,"currentScore",0),o(this,"finalScore",0),o(this,"gameStarted",!1),o(this,"webViewBridge",null),o(this,"state",{}),o(this,"isSDKReady",!1),o(this,"callbacks",{});var t=1,n=0;this.version.split(".").reverse().forEach((function(e){n+=t*e,t*=100})),this.versionCode=n,console.log("SDK constructor run: "+this.version+" : "+this.versionCode+" : "+n),this.isWebView()?this.addWebViewListeners():this.addParentFrameListeners()}var t,s,l;return t=e,(s=[{key:"addParentFrameListeners",value:function(){var e=this;window.addEventListener("message",(function(t){var n,o,i=t.data.eventName||null,r=t.data.data||null;switch(e.triggerSingleOpponentJoined=function(){e.otherPlayers.forEach((function(t){e.onOpponentJoined(t,!0)}))},i){case"match_info":console.log("Received match info",r),e.matchType=r.matchType,e.gameType=r.gameType,e.currentUser=r.current_user,e.otherPlayers=null!==(n=r.other_players)&&void 0!==n?n:[],e.state=null!==(o=r.state)&&void 0!==o?o:{},e.isSDKReady=!0,e.onReady(),e.triggerSingleOpponentJoined();break;case"current_user":console.log("Received current user",r),e.currentUser=r,e.isSDKReady||(e.isSDKReady=!0,e.onReady());break;case"opponent_left":console.log("Opponent left",r),e.otherPlayers.forEach((function(t){r.name===t.id&&delete e.otherPlayers[t.id]})),e.onOpponentLeft(r);break;case"other_players":console.log("Received other players",r),e.otherPlayers=r,e.triggerSingleOpponentJoined();break;case"opponent_joined":e.otherPlayers.push(r),e.onOpponentJoined(r,!1);break;case"custom_event":var a=r.eventCode,s=r.data,l=r.userId;e.onEvent(a,s,l);break;case"get_custom_data":case"set_custom_data":console.log(i+": "+r);var c=r.data||null,u=r.error||null,d=t.data.callbackKey||null;e.callbacks[d]&&e.callbacks[d](c,u)}}),!1),this.emit("sdk_injected",this.versionCode)}},{key:"iframeCallbackHandler",value:function(e,t){this.callbacks[e]=t}},{key:"addWebViewListeners",value:function(){var e=this;window.addEventListener("ns-brige-ready",(function(t){console.log("Web view bridge is ready now!.GoPlay SDK is ready now"),e.webViewBridge=t.detail||window.nsWebViewBridge,e.webViewBridge.on("match_info",(function(t){var n,o;console.log("Received match info",t),e.matchType=t.matchType,e.currentUser=t.current_user,e.otherPlayers=null!==(n=t.other_players)&&void 0!==n?n:[],e.state=null!==(o=t.state)&&void 0!==o?o:{},e.isSDKReady=!0,e.onReady(),e.triggerSingleOpponentJoined()})),e.webViewBridge.on("current_user",(function(t){console.log("Received current user",t),e.currentUser=t,e.isSDKReady||(e.isSDKReady=!0,e.onReady())})),e.webViewBridge.on("opponent_left",(function(t){console.log("Opponent left",t),e.otherPlayers.forEach((function(n){t.name===n.id&&delete e.otherPlayers[n.id]})),e.onOpponentLeft(t)})),e.webViewBridge.on("other_players",(function(t){console.log("Received other players",t),e.otherPlayers=t,e.triggerSingleOpponentJoined()})),e.webViewBridge.on("opponent_joined",(function(t){e.otherPlayers.push(t),e.onOpponentJoined(t,!1),console.log("New opponent joined",t)})),e.triggerSingleOpponentJoined=function(){e.otherPlayers.forEach((function(t){e.onOpponentJoined(t,!0)}))},e.webViewBridge.on("custom_event",(function(t){var n=t.eventCode,o=t.data,i=t.userId;e.onEvent(n,o,i)})),e.emit("sdk_injected",e.versionCode)}))}},{key:"emit",value:function(e,t,n){this.isWebView()?this.emitToNativeScript(e,t):this.emitToParentWindow(e,t,n)}},{key:"isWebView",value:function(){var e=window.self==window.top;return console.log("Is webview: ",e),e}},{key:"emitToParentWindow",value:function(e,t,n){window.parent.postMessage({eventName:e,data:JSON.stringify(t),callbackKey:n},"*")}},{key:"emitToNativeScript",value:function(e,t){var n=this.webViewBridge||window.nsWebViewBridge;n?(n.emit(e,t),console.log("".concat("Emit data to web view",": signal >>> ").concat(e,", ")," data >>> ".concat(t))):console.log("The webview bridge has not been injected yet!")}},{key:"getVersion",value:function(){return this.emit("version",this.version),this.version}},{key:"getCurrentPlayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.gameStarted)return e&&e(this.currentUser),this.currentUser;t&&t(a)}},{key:"onReady",value:function(){}},{key:"onEvent",value:function(e,t,n){}},{key:"onOpponentJoined",value:function(e,t){}},{key:"onOpponentLeft",value:function(e){}},{key:"getOtherPlayers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.gameStarted)return e?(e(this.otherPlayers),this.otherPlayers):void 0;t&&t(a)}},{key:"startGame",value:function(){this.gameStarted=!0,this.emit("start_game",{score:this.currentScore,state:this.state})}},{key:"updateCurrentScore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.gameStarted?(this.currentScore=e,this.emit("current_score",{score:this.currentScore,state:this.state}),t&&t(this.currentScore)):n&&n(a)}},{key:"updateFinalScore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.gameStarted?(this.finalScore=e,this.emit("final_score",{score:this.finalScore,state:this.state,stopGame:o,save:i}),t&&t(this.finalScore)):n&&n(a)}},{key:"abortGame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.gameStarted?(this.emit("abort_game",e),t&&t(e)):n&&n(a)}},{key:"sendPause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.emit("pause_game",e)}},{key:"sendResume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.emit("resume_game",e)}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.emit("custom_event",{eventCode:e,data:t,save:n})}},{key:"setCustomData",value:function(e,t){var n=this;if(console.log(">>>> Registed event set_custom_data!"),this.isWebView())this.emit("set_custom_data",{valueObj:e}),this.webViewBridge.on("set_custom_data",(function(e){var o=e.success,i=e.error;t(o,i),n.webViewBridge.off("set_custom_data",(function(){console.log(">>>> Unregisted event set_custom_data!")}))}));else{var o=(new Date).getTime()+"_SET_CUSTOM_DATA";this.emit("set_custom_data",{valueObj:e},o),this.iframeCallbackHandler(o,t)}}},{key:"getCustomData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;if(this.isWebView())this.emit("get_custom_data",{properties:t}),console.log(">>>> Registed event get_custom_data!"),this.webViewBridge.on("get_custom_data",(function(t){var o=t.data,i=t.error;n(o,i),e.webViewBridge.off("get_custom_data",(function(){console.log(">>>> Unregisted event get_custom_data!")}))}));else{var o=(new Date).getTime()+"_GET_CUSTOM_DATA";this.emit("get_custom_data",{properties:t},o),this.iframeCallbackHandler(o,n)}}},{key:"hidePlatformQuitButton",value:function(){this.gameStarted&&this.emit("hide_quit_button",{hide:!0})}},{key:"showAvatar",value:function(e){this.emit("show_avatar",{userId:e})}}])&&n(t.prototype,s),l&&n(t,l),e}();window.MATCH_TYPE=i,window.GoPlaySDK=new s,s=window.GoPlaySDK}])}));